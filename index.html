<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WorldNav - Global Travel Companion</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#5D5CDE">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: '#5D5CDE', 'primary-dark': '#4B4BC8' }
        }
      }
    };
  </script>
  <style>
    :root { color-scheme: light dark; }
    .gradient-bg { background: linear-gradient(135deg, #5D5CDE 0%, #7B7AE8 100%); }
    .card-hover { transition: transform .2s ease, box-shadow .2s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(93,92,222,.15);}
    .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #5D5CDE; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #splash { position: fixed; inset: 0; display: grid; place-items: center; z-index: 50; background: linear-gradient(135deg, #5D5CDE 0%, #7B7AE8 100%); transition: opacity .6s ease; }
    #splash.fade-out { opacity: 0; pointer-events: none; }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
  <div id="splash">
    <div class="flex flex-col items-center text-white">
      <i class="fas fa-globe-americas text-5xl mb-4 drop-shadow-xl"></i>
      <h1 class="text-2xl font-extrabold tracking-wide">WorldNav</h1>
      <p class="opacity-90 mt-1">Global Travel Companion</p>
      <div class="mt-6 w-10 h-10 loading-spinner border-white border-t-transparent rounded-full"></div>
    </div>
  </div>

  <header class="gradient-bg text-white p-4 shadow-lg">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <i class="fas fa-globe-americas text-2xl"></i>
          <h1 class="text-2xl font-bold">WorldNav</h1>
        </div>
        <div class="flex items-center space-x-2">
          <span id="modeLabel" class="text-xs opacity-90">Manual Mode</span>
          <button id="modeToggle" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm">üåê Switch to Live</button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4">
    <section class="mb-8">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-4 flex items-center"><i class="fas fa-search text-primary mr-2"></i> Destination Search</h2>
        <div class="flex flex-col md:flex-row gap-4">
          <input type="text" id="locationInput" placeholder="Enter city or country name"
                 class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-base">
          <button id="btnSearch" class="px-6 py-3 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium transition-colors">
            <i class="fas fa-search mr-2"></i>Search
          </button>
        </div>
      </div>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover cursor-pointer" onclick="showPlacesSection()">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-map-marked-alt text-2xl text-blue-600 dark:text-blue-400"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">Places & Activities</h3>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Discover attractions, restaurants, and activities</p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover cursor-pointer" onclick="showTrafficSection()">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-traffic-light text-2xl text-red-600 dark:text-red-400"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">Live Traffic</h3>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Real-time traffic conditions and routes</p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover cursor-pointer" onclick="showWeatherSection()">
        <div class="text-center">
          <div class="w-16 h-16 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-cloud-sun text-2xl text-yellow-600 dark:text-yellow-400"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">Weather Monitor</h3>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Current weather and forecasts</p>
        </div>
      </div>

      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 card-hover cursor-pointer" onclick="showVisaSection()">
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-passport text-2xl text-green-600 dark:text-green-400"></i>
          </div>
          <h3 class="text-lg font-semibold mb-2">Visa Requirements</h3>
          <p class="text-gray-600 dark:text-gray-400 text-sm">Check visa requirements and travel docs</p>
        </div>
      </div>
    </section>

    <section id="placesSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center"><i class="fas fa-map-marked-alt text-primary mr-2"></i> Places & Activities</h2>
        <button onclick="hideSections()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"><i class="fas fa-times"></i></button>
      </div>
      <div id="placesResults" class="space-y-4"></div>
    </section>

    <section id="trafficSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center"><i class="fas fa-traffic-light text-primary mr-2"></i> Live Traffic Monitor</h2>
        <button onclick="hideSections()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"><i class="fas fa-times"></i></button>
      </div>
      <div id="trafficResults" class="space-y-4"></div>
    </section>

    <section id="weatherSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center"><i class="fas fa-cloud-sun text-primary mr-2"></i> Weather Monitor</h2>
        <button onclick="hideSections()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"><i class="fas fa-times"></i></button>
      </div>
      <div id="weatherResults" class="space-y-4"></div>
    </section>

    <section id="visaSection" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center"><i class="fas fa-passport text-primary mr-2"></i> Visa Requirements</h2>
        <button onclick="hideSections()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"><i class="fas fa-times"></i></button>
      </div>
      <div id="visaResults" class="space-y-4"></div>
    </section>
  </main>

  <footer class="bg-gray-100 dark:bg-gray-800 mt-12 py-8">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p class="text-gray-600 dark:text-gray-400"><i class="fas fa-globe-americas text-primary mr-2"></i> WorldNav - Making global travel easier and smarter</p>
    </div>
  </footer>

  <script>
    // Dark mode
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      document.documentElement.classList.toggle('dark', e.matches);
    });

    // Splash fade-out
    window.addEventListener('load', () => {
      setTimeout(() => document.getElementById('splash').classList.add('fade-out'), 700);
    });

    // CONFIG
    const CONFIG = { OPENWEATHER_KEY: "PASTE_OPENWEATHER_API_KEY_HERE", GOOGLE_MAPS_KEY: "PUT API KEY HERE" };
    const modeKey = "worldnavMode";
    const $ = (id) => document.getElementById(id);

    function getMode(){ return localStorage.getItem(modeKey) || "manual"; }
    function setMode(m){ localStorage.setItem(modeKey, m); updateModeUI(); }

    function updateModeUI(){
      const mode = getMode();
      const label = $('modeLabel'); const btn = $('modeToggle');
      if (mode === "live"){ label.textContent = "Live Mode"; btn.textContent = "‚Ü©Ô∏è Switch to Manual"; }
      else { label.textContent = "Manual Mode"; btn.textContent = "üåê Switch to Live"; }
    }
    $('modeToggle').addEventListener('click', () => setMode(getMode()==="live"?"manual":"live"));
    updateModeUI();

    async function loadOffline(){ const r = await fetch('./offline-data.json'); return r.json(); }
    function showSection(id){ hideSections(); $(id).classList.remove('hidden'); }
    function hideSections(){ ['placesSection','trafficSection','weatherSection','visaSection'].forEach(id=>$(id).classList.add('hidden')); }
    function render(elId, md){ $(elId).innerHTML = `<div class='prose dark:prose-invert max-w-none'>${marked.parse(md)}</div>`; }

    function showPlacesSection(){ showSection('placesSection'); fetchPlaces(); }
    function showTrafficSection(){ showSection('trafficSection'); fetchTraffic(); }
    function showWeatherSection(){ showSection('weatherSection'); fetchWeather(); }
    function showVisaSection(){ showSection('visaSection'); fetchVisa(); }

    async function fetchPlaces(){
      const mode = getMode();
      const loc = $('locationInput').value.trim() || "Global";
      if (mode==="live" && CONFIG.GOOGLE_MAPS_KEY!=="PASTE_GOOGLE_MAPS_API_KEY_HERE"){
        render('placesResults', `### Places near **${loc}** (Live)  
- Integrate Google Maps JavaScript SDK or a backend proxy for Places API results.
- Placeholder shown here to avoid CORS limitations in static hosting.`);
      } else {
        const data = await loadOffline();
        const hit = data.samples.destinations.find(d=>d.name.toLowerCase().includes(loc.toLowerCase())) || data.samples.destinations[0];
        render('placesResults', `# ${hit.name}
**Overview**: ${hit.overview}

**Top attractions**
${hit.top_attractions.map(a=>`- ${a}`).join('\n')}

**Local food**
${hit.food.map(a=>`- ${a}`).join('\n')}

**Best time**: ${hit.best_time}

**Tips**
${hit.tips.map(a=>`- ${a}`).join('\n')}`);
      }
    }

    async function fetchWeather(){
      const mode = getMode();
      const loc = $('locationInput').value.trim() || "Paris, France";
      if (mode==="live" && CONFIG.OPENWEATHER_KEY!=="PASTE_OPENWEATHER_API_KEY_HERE"){
        try{
          const u = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(loc)}&appid=${CONFIG.OPENWEATHER_KEY}&units=metric`;
          const r = await fetch(u); const j = await r.json();
          render('weatherResults', `### Weather ‚Äî **${loc}**
- Now: **${j?.main?.temp ?? "n/a"}¬∞C**, ${j?.weather?.[0]?.description ?? "n/a"}
- Wind: ${j?.wind?.speed ?? "n/a"} m/s
- Humidity: ${j?.main?.humidity ?? "n/a"}%`);
          return;
        } catch(e){ /* fall through to manual */ }
      }
      const data = await loadOffline();
      const key = Object.keys(data.samples.weather).find(k=>k.toLowerCase().includes(loc.toLowerCase())) || "Paris, France";
      const w = data.samples.weather[key];
      render('weatherResults', `### Weather ‚Äî **${key}**
- Now: ${w.now}
- Next 3 days:
${w["3day"].map(d=>`- ${d}`).join('\n')}`);
    }

   async function fetchPlaces(){
  const mode = getMode();
  const loc = $('locationInput').value.trim() || "Global";
  
  if (mode === "live" && CONFIG.GOOGLE_MAPS_KEY !== "PLEASE API KEY HERE") {
    try {
      const response = await fetch(
        `https://maps.googleapis.com/maps/api/place/textsearch/json?query=${encodeURIComponent(loc)}&key=${CONFIG.GOOGLE_MAPS_KEY}`
      );
      const data = await response.json();
      
      if (data.status !== "OK") {
        render('placesResults', `‚ö†Ô∏è Error: ${data.status}  
        Try another location or check API quota.`);
        return;
      }

      const results = data.results.slice(0, 10).map(p => `
      - **${p.name}** (${p.formatted_address || "Address unavailable"})  
        ‚≠ê Rating: ${p.rating || "N/A"}  
        ${p.types ? p.types.slice(0, 3).join(", ") : ""}
      `).join('\n');

      render('placesResults', `# Top Places in ${loc}\n${results}`);
      return;

    } catch (error) {
      render('placesResults', `‚ùå Failed to fetch live data: ${error.message}`);
      return;
    }
  }

  // Fallback: manual/offline mode
  const data = await loadOffline();
  const hit = data.samples.destinations.find(
    d => d.name.toLowerCase().includes(loc.toLowerCase())
  ) || data.samples.destinations[0];

  render('placesResults', `# ${hit.name}
**Overview**: ${hit.overview}

**Top attractions**
${hit.top_attractions.map(a=>`- ${a}`).join('\n')}

**Local food**
${hit.food.map(a=>`- ${a}`).join('\n')}

**Best time**: ${hit.best_time}

**Tips**
${hit.tips.map(a=>`- ${a}`).join('\n')}`);
}
